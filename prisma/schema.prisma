generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

model User {
  id            String         @id @default(cuid())
  email         String         @unique
  password      String
  name          String?
  role          Role           @default(USER)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  
  // NEW FIELDS - Optional with defaults for backward compatibility
  annualLeaveBalance Float     @default(32)  // Existing 32 days
  toilBalance        Float     @default(0)   // Start at 0
  sickLeaveBalance   Float     @default(3)   // Contract specifies 3 days
  
  leaveRequests LeaveRequest[]
  toilEntries   ToilEntry[]    // NEW relation

  @@map("users")
}

model LeaveRequest {
  id        String      @id @default(cuid())
  startDate DateTime
  endDate   DateTime
  status    LeaveStatus @default(PENDING)
  comments  String?
  
  // NEW FIELDS - With defaults for backward compatibility
  type      LeaveType   @default(ANNUAL)  // Default to ANNUAL for existing records
  hours     Float?      // For TOIL requests (optional)
  
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  userId    String
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("leave_requests")
}

// NEW MODEL - Won't affect existing functionality
model ToilEntry {
  id          String      @id @default(cuid())
  userId      String
  date        DateTime
  type        ToilType
  hours       Float
  reason      String
  approved    Boolean     @default(false)
  approvedBy  String?
  approvedAt  DateTime?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  // Audit trail fields
  adjustmentReason String?
  previousBalance  Float?
  newBalance       Float?
  
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("toil_entries")
}

enum Role {
  USER
  ADMIN
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

// NEW ENUM - Leave types
enum LeaveType {
  ANNUAL
  TOIL
  SICK
}

// NEW ENUM - Contract-based TOIL types
enum ToilType {
  TRAVEL_LATE_RETURN    // Section 6.6(d)
  WEEKEND_TRAVEL        // Section 6.6(c)  
  AGENT_PANEL_DAY      // Section 6.6(b)
  OVERTIME             // General overtime
}
